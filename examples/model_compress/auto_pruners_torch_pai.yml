protocolVersion: 2
name: SAPruner_cifar10_finetune_01
type: job
jobRetryCount: 0
prerequisites:
  - type: dockerimage
    uri: 'gusui/nni:sapruner'
    name: docker_image_0
taskRoles:
  taskrole:
    instances: 1
    completion:
      minFailedInstances: 1
      minSucceededInstances: -1
    taskRetryCount: 0
    dockerImage: docker_image_0
    resourcePerInstance:
      gpu: 1
      cpu: 4
      memoryMB: 8192
    commands:
      - apt update
      - apt install -y nfs-common
      - mkdir /mnt/nfs-storage
      - 'mount -t nfs 10.151.40.36:/ /mnt/nfs-storage'
      - git clone -b sapruner https://github.com/suiguoxin/nni/
      # SimulatedPruner, channel, Cifar10, vgg16
      - cd nni && python3 examples/model_compress/auto_pruners_torch.py --epochs 100 --pruner SimulatedAnnealingPruner --pruning-mode channel --cool-down-rate 0.9 --sparsity 0.1 --dataset cifar10 --fine-tune True --fine-tune-epochs 50 --data-dir /mnt/nfs-storage/users/sgx/cifar10 --experiment-data-dir /mnt/nfs-storage/users/sgx/experiment_data/cifar10/SimualtedAnnealing/01
      
      # NetAdaptPruner, channel, MNIST, LeNet
      # - cd nni && python3 examples/model_compress/auto_pruners_torch.py --epochs 1 --pruner NetAdaptPruner --pruning-mode channel --pruning-step 0.05 --sparsity 0.1 --dataset mnist --fine-tune True --fine-tune-epochs 10 --data-dir /mnt/nfs-storage/users/sgx/mnist --experiment-data-dir /mnt/nfs-storage/users/sgx/experiment_data/mnist/NetAdapt/01
      
      # NetAdaptPruner, channel, Cifar10, vgg16
      # - cd nni && python3 examples/model_compress/auto_pruners_torch.py --epochs 100 --pruner NetAdaptPruner --pruning-mode channel --pruning-step 0.05 --sparsity 0.1 --dataset cifar10 --fine-tune True --fine-tune-epochs 50 --data-dir /mnt/nfs-storage/users/sgx/cifar10 --experiment-data-dir /mnt/nfs-storage/users/sgx/experiment_data/cifar10/NetAdapt/01
      
      # NetAdaptPruner, channel, imagenet, MobileNetV2
      # - cd nni && python3 examples/model_compress/auto_pruners_torch.py --pruner NetAdaptPruner --pruning-mode channel --pruning-step 0.05 --sparsity 0.1 --dataset imagenet --fine-tune True --fine-tune-epochs 10 --data-dir /mnt/nfs-storage/users/sgx/imagenet --experiment-data-dir /mnt/nfs-storage/users/sgx/experiment_data/imagenet/NetAdapt/01
defaults:
  virtualCluster: default
extras:
  com.microsoft.pai.runtimeplugin:
    - plugin: ssh
      parameters:
        jobssh: true
        userssh:
          type: custom
          value: >-
            ssh-rsa
            AAAAB3NzaC1yc2EAAAADAQABAAACAQDj0VbJa5ekhI6Htuf/9hkXaYZkDv9BRVuYFKvckjQ0Z552NcFX8Dtl8n2hM/+KY8HP5guYfB4xOOq1373y9HIIRoRU2aa2zlUKzEP+5HggawRXU5Qwy9+EHvTJwfCKh6WHIeoiU5APJ1XZD7RuFeA0y5dDwdHYIfyZNEJVmNolb5yYT7RRGpCJXTIPWNP9+WwAmflRqR3kitPhwbT7SU9btBidXmEczQJI+kjZGnky2CuSDElstWhP10AAya1vlc4KHf3EQ362mM7k8s14wNUeHLK8k6mFGG0FNSWiw2spqtlHDuFWfWeu3xNnt4B7wtmHc1k7Aom7jyxqfDXE4jKNGuPafe9xyvgzyUyWRHzRKUHpADAuMBZbvw4acVdWWVfiE0ve5uMqRDgiT+7HBEjTb6DJclgOURAQtSJZXdcfEvuvHnXSzFay3ng57dpTrlEVCdKl5w/OCuuZxtLSbjOyLx6hDtLI/G2CMLrjpylcHfqUHqDEq9Iws6EO5W7lQnu0i2tv0/mG1jpfp1h2KyzMHU1zTVxOfU/CqH3QmQc7GvTbN+HtMpiecpSSxEd8dwYw32dH4VO3SClXTO+3dzh+oHXeFOWidceTLwBszy8B2Z0v+2IGmvisPiFzM0jj84Z2xpUHGnP1Ocq/cOHRNFp3WH4oXXMtIc8Rc8M+uuWeSQ==
            suiguoxin@gmail.com
